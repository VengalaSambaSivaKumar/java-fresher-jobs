<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Java Fresher Jobs Dashboard</title>
  <style>
    :root{
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --border: #e2e8f0;
      --accent: #2563eb;
      --badge: #e2e8f0;
      --success:#16a34a;
    }
    *{ box-sizing: border-box; }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji"; }
    .container{ max-width:1100px; margin:0 auto; padding:24px; }
    header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px; }
    h1{ font-size:20px; margin:0; }
    .subtitle{ color:var(--muted); font-size:12px; }
    .controls{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    button, .btnlike, select, input[type="file"], input[type="text"]{
      font-size:14px; padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#fff; color:var(--text);
    }
    button.primary{ background:var(--accent); color:#fff; border-color:var(--accent); }
    button.ghost{ background:transparent; }
    button:disabled{ opacity:0.6; cursor:not-allowed; }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); padding:16px; }
    .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .grid{ display:grid; gap:12px; }
    .grid-3{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    .badge{ display:inline-flex; align-items:center; gap:6px; background:var(--badge); color:#0f172a; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); }
    .muted{ color:var(--muted); font-size:12px; }
    .list{ display:flex; flex-direction:column; }
    .item{ display:flex; flex-direction:column; gap:6px; padding:12px 0; border-bottom:1px solid var(--border); }
    .item:last-child{ border-bottom:none; }
    .titlelink{ font-weight:600; text-decoration:none; color:var(--text); }
    .titlelink:hover{ text-decoration:underline; }
    .right{ display:flex; gap:8px; align-items:center; margin-left:auto; }
    .hidden{ display:none; }
    .counts .badge{ margin-right:6px; margin-bottom:6px; }
    .meta{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .green{ color:var(--success); }
    .footer{ text-align:center; color:var(--muted); font-size:12px; padding-top:16px; }
    @media (max-width: 720px){ .grid-3{ grid-template-columns: 1fr; } .right{ margin-left:0; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Java Fresher Jobs Dashboard</h1>
        <div class="subtitle">Hyderabad Â· Bengaluru Â· Chennai Â· Mysuru Â· Visakhapatnam Â· Vijayawada</div>
      </div>
      <div class="row">
        <button id="refreshBtn" class="ghost">ðŸ”„ Refresh</button>
        <label class="btnlike">ðŸ“¥ Import CSV
          <input id="fileInput" type="file" accept=".csv" class="hidden" />
        </label>
      </div>
    </header>

    <div class="card row">
      <input id="search" type="text" placeholder="Search title or company..." />
      <select id="city">
        <option value="all">All Cities</option>
        <option>Hyderabad</option><option>Bengaluru</option><option>Chennai</option>
        <option>Mysuru</option><option>Visakhapatnam</option><option>Vijayawada</option>
      </select>
      <select id="orgType">
        <option value="all">All Types</option>
        <option>MNC</option><option>Product</option><option>Service</option><option>Startup</option><option>Hybrid</option>
      </select>
      <button id="resetBtn" class="ghost">âœ– Reset</button>
      <button id="exportBtn">â¬‡ Export JSON</button>
    </div>

    <div class="grid grid-3">
      <div class="card counts">
        <div class="muted">By City</div>
        <div id="countCity"></div>
      </div>
      <div class="card counts">
        <div class="muted">By Org Type</div>
        <div id="countType"></div>
      </div>
      <div class="card">
        <div class="muted">Dataset</div>
        <div id="datasetInfo" class="muted">Jobs loaded: 0</div>
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content: space-between;">
        <div><strong>Listings</strong> <span class="muted" id="listCount"></span></div>
        <div class="row">
          <button class="ghost" id="sortDate">â†• Date</button>
          <button class="ghost" id="sortCompany">â†• Company</button>
          <button class="ghost" id="sortTitle">â†• Title</button>
        </div>
      </div>
      <div id="list" class="list"></div>
      <div id="empty" class="muted">No jobs loaded yet. Use <strong>Import CSV</strong> to add todayâ€™s jobs.</div>
    </div>

    <div class="footer">Bookmark this page Â· Data is saved in your browser (localStorage)</div>
  </div>

  <script>
    const STORAGE_KEY = 'java_fresher_jobs_data';
    let jobs = [];
    let sortKey = 'postingDate';
    let sortDir = 'desc';

    const $ = (id)=> document.getElementById(id);

    function saveLocal(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(jobs)); }
    function loadLocal(){
      try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : []; }
      catch{ return []; }
    }

    function parseCSV(text){
      const lines = text.trim().split(/\\r?\\n/);
      const header = lines.shift()?.split(',').map(h=>h.trim().toLowerCase()) || [];
      const idx = (k)=> header.indexOf(k);
      const out = [];
      for(const line of lines){
        const cols = line.split(',').map(c=>c.trim());
        if(cols.length < 8) continue;
        out.push({
          title: cols[idx('job title')] ?? cols[0],
          company: cols[idx('company')] ?? cols[1],
          orgType: cols[idx('organization type')] ?? cols[2],
          city: cols[idx('city')] ?? cols[3],
          workMode: cols[idx('on-site/remote/hybrid')] ?? cols[4],
          source: cols[idx('source')] ?? cols[5],
          postingDate: cols[idx('posting date')] ?? cols[6],
          link: cols[idx('apply link')] ?? cols[7],
          salary: cols[idx('salary')] ?? cols[8] || '',
          skills: cols[idx('skills')] ?? cols[9] || '',
          eligibility: cols[idx('eligibility')] ?? cols[10] || '',
          status: cols[idx('status')] ?? ''
        });
      }
      return out;
    }

    function relLabel(dstr){
      const d = new Date(dstr);
      if (isNaN(d)) return 'recent';
      const diff = (Date.now() - d.getTime()) / (1000*60*60*24);
      if (diff < 1) return 'new';
      if (diff < 7) return 'recent';
      return 'old';
    }

    function render(){
      const q = $('search').value.trim().toLowerCase();
      const city = $('city').value;
      const orgType = $('orgType').value;

      let view = jobs.filter(j=>{
        if (city !== 'all' && j.city !== city) return false;
        if (orgType !== 'all' && j.orgType !== orgType) return false;
        if (q && !(j.title.toLowerCase().includes(q) || j.company.toLowerCase().includes(q))) return false;
        return true;
      }).map(j=> ({...j, status: j.status || relLabel(j.postingDate)}));

      view.sort((a,b)=>{
        if (sortKey === 'postingDate'){
          const da = new Date(a.postingDate).getTime() || 0;
          const db = new Date(b.postingDate).getTime() || 0;
          return (db - da) * (sortDir === 'desc' ? 1 : -1);
        }
        const av = (a[sortKey]||'').toString().toLowerCase();
        const bv = (b[sortKey]||'').toString().toLowerCase();
        if (av < bv) return sortDir==='asc' ? -1 : 1;
        if (av > bv) return sortDir==='asc' ? 1 : -1;
        return 0;
      });

      $('list').innerHTML = '';
      $('listCount').textContent = `(${view.length})`;
      $('datasetInfo').textContent = `Jobs loaded: ${jobs.length}`;
      $('empty').style.display = view.length ? 'none' : 'block';

      const byCity = {}, byType = {};
      for(const j of view){ byCity[j.city]=(byCity[j.city]||0)+1; byType[j.orgType]=(byType[j.orgType]||0)+1; }
      $('countCity').innerHTML = Object.keys(byCity).length ? Object.entries(byCity).map(([k,v])=>`<span class="badge">${k}: ${v}</span>`).join(' ') : '<span class="muted">No data</span>';
      $('countType').innerHTML = Object.keys(byType).length ? Object.entries(byType).map(([k,v])=>`<span class="badge">${k}: ${v}</span>`).join(' ') : '<span class="muted">No data</span>';

      for(const j of view){
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div class="row" style="justify-content:space-between; align-items:flex-start;">
            <div style="min-width:0;">
              <a href="${j.link}" target="_blank" rel="noreferrer" class="titlelink">${j.title}</a>
              <div class="muted">${j.company} Â· ${j.city} Â· ${j.orgType} Â· ${new Date(j.postingDate).toDateString()}</div>
              ${j.salary ? `<div class="green">ðŸ’° ${j.salary}</div>`:''}
              ${j.skills ? `<div class="muted">ðŸ§  Skills: ${j.skills}</div>`:''}
              ${j.eligibility ? `<div class="muted">ðŸŽ“ Eligibility: ${j.eligibility}</div>`:''}
            </div>
            <div class="right">
              <span class="badge">${j.workMode||''}</span>
              <span class="badge">${j.source||''}</span>
              <a href="${j.link}" target="_blank" rel="noreferrer"><button class="primary">Apply</button></a>
            </div>
          </div>
        `;
        $('list').appendChild(div);
      }
    }

    function exportJSON(){
      const qdata = JSON.stringify(jobs, null, 2);
      const blob = new Blob([qdata], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'jobs_java_fresher_daily.json'; a.click();
      URL.revokeObjectURL(url);
    }

    // Event handlers
    $('fileInput').addEventListener('change', e=>{
      const f = e.target.files && e.target.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const text = String(reader.result||'');
          const data = parseCSV(text);
          jobs = data;
          saveLocal();
          render();
          alert(`Imported ${data.length} rows.`);
        }catch{ alert('Could not parse file.'); }
      };
      reader.readAsText(f);
    });

    $('refreshBtn').addEventListener('click', async ()=>{
      try{
        const res = await fetch('jobs_java_fresher_daily.csv', {cache:'no-store'});
        const text = await res.text();
        const data = parseCSV(text);
        jobs = data; saveLocal(); render();
        alert(`Loaded ${data.length} latest job listings.`);
      }catch{ alert(\"Couldn't find today's CSV in the same folder. Place 'jobs_java_fresher_daily.csv' next to this HTML and click Refresh again.\"); }
    });

    $('resetBtn').addEventListener('click', ()=>{
      $('search').value=''; $('city').value='all'; $('orgType').value='all'; render();
    });
    $('exportBtn').addEventListener('click', exportJSON);
    $('search').addEventListener('input', render);
    $('city').addEventListener('change', render);
    $('orgType').addEventListener('change', render);

    $('sortDate').addEventListener('click', ()=>{ sortKey='postingDate'; sortDir = sortDir==='asc' ? 'desc' : 'asc'; render(); });
    $('sortCompany').addEventListener('click', ()=>{ sortKey='company'; sortDir = sortDir==='asc' ? 'desc' : 'asc'; render(); });
    $('sortTitle').addEventListener('click', ()=>{ sortKey='title'; sortDir = sortDir==='asc' ? 'desc' : 'asc'; render(); });

    // Init
    jobs = loadLocal();
    render();
  </script>
</body>
</html>
